
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/other/gcm/plot_twofaced_gcm.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_other_gcm_plot_twofaced_gcm.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_other_gcm_plot_twofaced_gcm.py:


Day-night mix model
===================

This example shows how to use the build-in 'two-face' planetary model.

.. GENERATED FROM PYTHON SOURCE LINES 8-22

.. code-block:: Python

    from pathlib import Path
    import matplotlib.pyplot as plt
    import numpy as np
    import yaml
    import cartopy.crs as ccrs
    from astropy import units as u
    from VSPEC import ObservationModel,PhaseAnalyzer
    import libpypsg as psg

    try:
        YAML_PATH = Path(__file__).parent / 'twoface.yaml'
    except NameError:
        YAML_PATH = Path('twoface.yaml')








.. GENERATED FROM PYTHON SOURCE LINES 23-24

Let's look at the GCM portion of the input file:

.. GENERATED FROM PYTHON SOURCE LINES 24-30

.. code-block:: Python


    with open(YAML_PATH) as f:
        d = yaml.safe_load(f)['gcm']

    print(yaml.dump(d))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    mean_molec_weight: 28
    twoface:
      albedo: 0.1
      co2: 1e-3
      h2o_d0: 1e-2
      h2o_d1: 1e-3
      h2o_n0: 1e-1
      h2o_n1: 1e-3
      n_const: 20
      n_linear: 10
      no2: 1e-3
      nphi: 90
      ntheta: 45
      o3: 1e-3
      p0d: 1 bar
      p0n: 2 bar
      p1d: 0.1 bar
      p1n: 0.1 bar
      p_top: 1e-5 bar
      scheme: cos2
      t0d: 500 K
      t0n: 300 K
      t1d: 450 K
      t1n: 400 K





.. GENERATED FROM PYTHON SOURCE LINES 31-34

Initialize the VSPEC run

We read in the config file.

.. GENERATED FROM PYTHON SOURCE LINES 34-37

.. code-block:: Python


    model = ObservationModel.from_yaml(YAML_PATH)








.. GENERATED FROM PYTHON SOURCE LINES 38-39

First, let's look at the planetary structure.

.. GENERATED FROM PYTHON SOURCE LINES 39-42

.. code-block:: Python


    gcm = model.params.gcm.get_gcm()








.. GENERATED FROM PYTHON SOURCE LINES 43-45

Map the planetary surface
-------------------------

.. GENERATED FROM PYTHON SOURCE LINES 45-59

.. code-block:: Python


    tsurf = gcm.tsurf.dat.to_value(u.K)

    fig = plt.figure()
    proj = ccrs.Mollweide(central_longitude=0)
    ax = fig.add_subplot(projection=proj)

    lats = gcm.lat_start + np.arange(gcm.shape[2]) * gcm.dlat.to_value(u.deg)
    lons = gcm.lon_start + np.arange(gcm.shape[1]) * gcm.dlon.to_value(u.deg)

    im=ax.pcolormesh(lons,lats,tsurf.T,cmap='inferno',transform=ccrs.PlateCarree())
    ax.coastlines()
    _=fig.colorbar(im,ax=ax,label='Surface Temperature (K)')




.. image-sg:: /auto_examples/other/gcm/images/sphx_glr_plot_twofaced_gcm_001.png
   :alt: plot twofaced gcm
   :srcset: /auto_examples/other/gcm/images/sphx_glr_plot_twofaced_gcm_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 60-61

Look at the profiles

.. GENERATED FROM PYTHON SOURCE LINES 61-93

.. code-block:: Python


    ilon_substellar = gcm.shape[1] // 2
    ilon_antistellar = 0
    ilon_terminator = gcm.shape[1] // 4

    ilat_equator = gcm.shape[2] // 2

    plt.close('all')
    fig = plt.figure()
    ax1 = fig.add_subplot(1, 2, 1)
    ax2 = fig.add_subplot(1, 2, 2)
    fig.subplots_adjust(wspace=0.4)

    for ilon, label,c in zip([ilon_substellar, ilon_antistellar, ilon_terminator], ['Substellar', 'Antistellar', 'Terminator'], ['b', 'k', 'r']):
        pressure = gcm.pressure.dat[:, ilon, ilat_equator]
        temperature = gcm.temperature.dat[:, ilon, ilat_equator]
        h2o = gcm.molecules[0].dat[:, ilon, ilat_equator]
        ax1.plot(temperature, pressure, label=label, color=c)
        ax2.plot(h2o*100, pressure, color=c)

    ax1.set_yscale('log')
    ax1.set_xlabel('Temperature (K)')
    ax1.set_ylabel('Pressure (bar)')
    ax1.set_ylim(np.flip(ax1.get_ylim()))
    ax1.legend(loc='upper left')

    ax2.set_xlabel('H2O (%)')
    ax2.set_ylabel('Pressure (bar)')
    ax2.set_yscale('log')
    _=ax2.set_ylim(np.flip(ax2.get_ylim()))





.. image-sg:: /auto_examples/other/gcm/images/sphx_glr_plot_twofaced_gcm_002.png
   :alt: plot twofaced gcm
   :srcset: /auto_examples/other/gcm/images/sphx_glr_plot_twofaced_gcm_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 94-95

Make the phase curve

.. GENERATED FROM PYTHON SOURCE LINES 95-117

.. code-block:: Python


    psg.docker.set_url_and_run()

    model.build_planet()
    model.build_spectra()

    data = PhaseAnalyzer.from_model(model)

    fig = plt.figure()
    ax = fig.add_subplot(1, 1, 1)

    im = ax.pcolormesh(
        data.wavelength.to_value(u.um),
        data.time.to_value(u.hour),
        (data.thermal/data.total*1e6).T,
        cmap='viridis'
    )
    ax.set_xlabel('Wavelength ($\\mu m$)')
    ax.set_ylabel('Time (hours)')

    _=fig.colorbar(im, ax=ax, label='Thermal Emission (ppm)')




.. image-sg:: /auto_examples/other/gcm/images/sphx_glr_plot_twofaced_gcm_003.png
   :alt: plot twofaced gcm
   :srcset: /auto_examples/other/gcm/images/sphx_glr_plot_twofaced_gcm_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Starting at phase 0.0 deg, observe for 10.0 d in 30 steps
    Phases = [  0.  12.  24.  36.  48.  60.  72.  84.  96. 108. 120. 132. 144. 156.
     168. 180. 192. 204. 216. 228. 240. 252. 264. 276. 288. 300. 312. 324.
     336. 348.   0.] deg
    Build Planet:   0%|          | 0/31 [00:00<?, ?it/s]    Build Planet:   3%|▎         | 1/31 [00:01<00:38,  1.29s/it]    Build Planet:   6%|▋         | 2/31 [00:02<00:37,  1.28s/it]    Build Planet:  10%|▉         | 3/31 [00:03<00:35,  1.27s/it]    Build Planet:  13%|█▎        | 4/31 [00:05<00:33,  1.26s/it]    Build Planet:  16%|█▌        | 5/31 [00:06<00:33,  1.28s/it]    Build Planet:  19%|█▉        | 6/31 [00:07<00:32,  1.28s/it]    Build Planet:  23%|██▎       | 7/31 [00:08<00:30,  1.29s/it]    Build Planet:  26%|██▌       | 8/31 [00:10<00:29,  1.26s/it]    Build Planet:  29%|██▉       | 9/31 [00:11<00:27,  1.26s/it]    Build Planet:  32%|███▏      | 10/31 [00:12<00:26,  1.25s/it]    Build Planet:  35%|███▌      | 11/31 [00:13<00:24,  1.24s/it]    Build Planet:  39%|███▊      | 12/31 [00:15<00:23,  1.23s/it]    Build Planet:  42%|████▏     | 13/31 [00:16<00:22,  1.23s/it]    Build Planet:  45%|████▌     | 14/31 [00:17<00:20,  1.23s/it]    Build Planet:  48%|████▊     | 15/31 [00:18<00:19,  1.23s/it]    Build Planet:  52%|█████▏    | 16/31 [00:19<00:18,  1.22s/it]    Build Planet:  55%|█████▍    | 17/31 [00:21<00:17,  1.23s/it]    Build Planet:  58%|█████▊    | 18/31 [00:22<00:15,  1.23s/it]    Build Planet:  61%|██████▏   | 19/31 [00:23<00:14,  1.23s/it]    Build Planet:  65%|██████▍   | 20/31 [00:24<00:13,  1.22s/it]    Build Planet:  68%|██████▊   | 21/31 [00:26<00:12,  1.22s/it]    Build Planet:  71%|███████   | 22/31 [00:27<00:10,  1.22s/it]    Build Planet:  74%|███████▍  | 23/31 [00:28<00:09,  1.23s/it]    Build Planet:  77%|███████▋  | 24/31 [00:29<00:08,  1.23s/it]    Build Planet:  81%|████████  | 25/31 [00:30<00:07,  1.22s/it]    Build Planet:  84%|████████▍ | 26/31 [00:32<00:06,  1.22s/it]    Build Planet:  87%|████████▋ | 27/31 [00:33<00:04,  1.22s/it]    Build Planet:  90%|█████████ | 28/31 [00:34<00:03,  1.22s/it]    Build Planet:  94%|█████████▎| 29/31 [00:35<00:02,  1.22s/it]    Build Planet:  97%|█████████▋| 30/31 [00:37<00:01,  1.24s/it]    Build Planet: 100%|██████████| 31/31 [00:38<00:00,  1.22s/it]    Build Planet: 100%|██████████| 31/31 [00:38<00:00,  1.24s/it]
    Creating interpolators:
    thermal    thermal, combined    thermal, combined, stellar    thermal, combined, stellar, photon noise    thermal, combined, stellar, photon noise, detector noise    thermal, combined, stellar, photon noise, detector noise, telescope noise    thermal, combined, stellar, photon noise, detector noise, telescope noise, background noise    thermal, combined, stellar, photon noise, detector noise, telescope noise, background noise, transit
    Finished!
    Build Spectra:   0%|          | 0/30 [00:00<?, ?it/s]
    Loading Spectra:   0%|          | 0/3 [00:00<?, ?it/s]PHOENIX grid for 3200 not found. Downloading...


    Downloading teff=3200:   0%|          | 0.00/33.6M [00:00<?, ?B/s]

    Downloading teff=3200:   0%|          | 4.10k/33.6M [00:00<1:10:21, 7.97kB/s]

    Downloading teff=3200:   0%|          | 45.1k/33.6M [00:00<06:02, 92.8kB/s]  

    Downloading teff=3200:   0%|          | 102k/33.6M [00:00<02:48, 199kB/s]  

    Downloading teff=3200:   1%|          | 225k/33.6M [00:00<01:16, 437kB/s]

    Downloading teff=3200:   1%|▏         | 475k/33.6M [00:00<00:35, 929kB/s]

    Downloading teff=3200:   3%|▎         | 983k/33.6M [00:01<00:16, 1.94MB/s]

    Downloading teff=3200:   6%|▌         | 1.98M/33.6M [00:01<00:08, 3.93MB/s]

    Downloading teff=3200:  12%|█▏        | 3.97M/33.6M [00:01<00:03, 7.96MB/s]

    Downloading teff=3200:  23%|██▎       | 7.72M/33.6M [00:01<00:01, 14.3MB/s]

    Downloading teff=3200:  34%|███▎      | 11.4M/33.6M [00:01<00:01, 19.1MB/s]

    Downloading teff=3200:  45%|████▌     | 15.2M/33.6M [00:01<00:00, 23.0MB/s]

    Downloading teff=3200:  56%|█████▌    | 18.7M/33.6M [00:01<00:00, 25.0MB/s]

    Downloading teff=3200:  67%|██████▋   | 22.4M/33.6M [00:01<00:00, 27.2MB/s]

    Downloading teff=3200:  77%|███████▋  | 25.9M/33.6M [00:02<00:00, 28.5MB/s]

    Downloading teff=3200:  88%|████████▊ | 29.6M/33.6M [00:02<00:00, 29.6MB/s]    Downloading teff=3200: 100%|██████████| 33.6M/33.6M [00:02<00:00, 15.5MB/s]

    Loading Spectra:  33%|███▎      | 1/3 [00:03<00:06,  3.06s/it]PHOENIX grid for 3300 not found. Downloading...


    Downloading teff=3300:   0%|          | 0.00/33.6M [00:00<?, ?B/s]

    Downloading teff=3300:   0%|          | 4.10k/33.6M [00:00<1:03:18, 8.83kB/s]

    Downloading teff=3300:   0%|          | 24.6k/33.6M [00:00<10:29, 53.3kB/s]  

    Downloading teff=3300:   0%|          | 90.1k/33.6M [00:00<02:52, 194kB/s] 

    Downloading teff=3300:   1%|          | 188k/33.6M [00:00<01:27, 380kB/s] 

    Downloading teff=3300:   1%|          | 385k/33.6M [00:00<00:43, 762kB/s]

    Downloading teff=3300:   2%|▏         | 811k/33.6M [00:01<00:20, 1.62MB/s]

    Downloading teff=3300:   5%|▍         | 1.64M/33.6M [00:01<00:09, 3.27MB/s]

    Downloading teff=3300:  10%|▉         | 3.31M/33.6M [00:01<00:04, 6.62MB/s]

    Downloading teff=3300:  18%|█▊        | 6.11M/33.6M [00:01<00:02, 12.4MB/s]

    Downloading teff=3300:  22%|██▏       | 7.48M/33.6M [00:01<00:02, 12.6MB/s]

    Downloading teff=3300:  34%|███▍      | 11.5M/33.6M [00:01<00:01, 19.2MB/s]

    Downloading teff=3300:  46%|████▌     | 15.3M/33.6M [00:01<00:00, 23.6MB/s]

    Downloading teff=3300:  57%|█████▋    | 19.2M/33.6M [00:01<00:00, 26.6MB/s]

    Downloading teff=3300:  69%|██████▊   | 23.0M/33.6M [00:01<00:00, 28.8MB/s]

    Downloading teff=3300:  81%|████████  | 27.1M/33.6M [00:02<00:00, 29.4MB/s]

    Downloading teff=3300:  91%|█████████ | 30.5M/33.6M [00:02<00:00, 29.3MB/s]    Downloading teff=3300: 100%|██████████| 33.6M/33.6M [00:02<00:00, 15.1MB/s]

    Loading Spectra:  67%|██████▋   | 2/3 [00:05<00:02,  2.98s/it]PHOENIX grid for 3400 not found. Downloading...


    Downloading teff=3400:   0%|          | 0.00/33.5M [00:00<?, ?B/s]

    Downloading teff=3400:   0%|          | 4.10k/33.5M [00:00<1:08:26, 8.15kB/s]

    Downloading teff=3400:   0%|          | 32.8k/33.5M [00:00<08:13, 67.7kB/s]  

    Downloading teff=3400:   0%|          | 94.2k/33.5M [00:00<02:55, 190kB/s] 

    Downloading teff=3400:   1%|          | 213k/33.5M [00:00<01:19, 420kB/s] 

    Downloading teff=3400:   1%|▏         | 438k/33.5M [00:00<00:38, 854kB/s]

    Downloading teff=3400:   3%|▎         | 897k/33.5M [00:01<00:18, 1.76MB/s]

    Downloading teff=3400:   5%|▌         | 1.79M/33.5M [00:01<00:08, 3.52MB/s]

    Downloading teff=3400:  11%|█         | 3.63M/33.5M [00:01<00:04, 7.20MB/s]

    Downloading teff=3400:  20%|█▉        | 6.67M/33.5M [00:01<00:02, 12.9MB/s]

    Downloading teff=3400:  31%|███▏      | 10.5M/33.5M [00:01<00:01, 19.0MB/s]

    Downloading teff=3400:  42%|████▏     | 13.9M/33.5M [00:01<00:00, 21.8MB/s]

    Downloading teff=3400:  53%|█████▎    | 17.8M/33.5M [00:01<00:00, 25.4MB/s]

    Downloading teff=3400:  64%|██████▍   | 21.5M/33.5M [00:01<00:00, 27.6MB/s]

    Downloading teff=3400:  76%|███████▌  | 25.3M/33.5M [00:01<00:00, 29.2MB/s]

    Downloading teff=3400:  87%|████████▋ | 29.1M/33.5M [00:02<00:00, 30.5MB/s]

    Downloading teff=3400:  98%|█████████▊| 32.9M/33.5M [00:02<00:00, 31.4MB/s]    Downloading teff=3400: 100%|██████████| 33.5M/33.5M [00:02<00:00, 14.9MB/s]

    Loading Spectra: 100%|██████████| 3/3 [00:08<00:00,  2.98s/it]    Loading Spectra: 100%|██████████| 3/3 [00:08<00:00,  2.99s/it]
    Build Spectra:   3%|▎         | 1/30 [00:09<04:28,  9.26s/it]    Build Spectra:   7%|▋         | 2/30 [00:09<01:50,  3.95s/it]    Build Spectra:  10%|█         | 3/30 [00:09<01:00,  2.25s/it]    Build Spectra:  13%|█▎        | 4/30 [00:09<00:37,  1.45s/it]    Build Spectra:  17%|█▋        | 5/30 [00:10<00:25,  1.01s/it]    Build Spectra:  20%|██        | 6/30 [00:10<00:17,  1.35it/s]    Build Spectra:  23%|██▎       | 7/30 [00:10<00:13,  1.74it/s]    Build Spectra:  27%|██▋       | 8/30 [00:10<00:10,  2.14it/s]    Build Spectra:  30%|███       | 9/30 [00:11<00:08,  2.55it/s]    Build Spectra:  33%|███▎      | 10/30 [00:11<00:06,  2.93it/s]    Build Spectra:  37%|███▋      | 11/30 [00:11<00:05,  3.26it/s]    Build Spectra:  40%|████      | 12/30 [00:11<00:05,  3.54it/s]    Build Spectra:  43%|████▎     | 13/30 [00:11<00:04,  3.77it/s]    Build Spectra:  47%|████▋     | 14/30 [00:12<00:04,  3.94it/s]    Build Spectra:  50%|█████     | 15/30 [00:12<00:03,  4.07it/s]    Build Spectra:  53%|█████▎    | 16/30 [00:12<00:03,  4.17it/s]    Build Spectra:  57%|█████▋    | 17/30 [00:12<00:03,  4.24it/s]    Build Spectra:  60%|██████    | 18/30 [00:13<00:02,  4.30it/s]    Build Spectra:  63%|██████▎   | 19/30 [00:13<00:02,  4.33it/s]    Build Spectra:  67%|██████▋   | 20/30 [00:13<00:02,  4.29it/s]    Build Spectra:  70%|███████   | 21/30 [00:13<00:02,  4.34it/s]    Build Spectra:  73%|███████▎  | 22/30 [00:14<00:01,  4.37it/s]    Build Spectra:  77%|███████▋  | 23/30 [00:14<00:01,  3.81it/s]    Build Spectra:  80%|████████  | 24/30 [00:14<00:01,  3.96it/s]    Build Spectra:  83%|████████▎ | 25/30 [00:14<00:01,  4.07it/s]    Build Spectra:  87%|████████▋ | 26/30 [00:15<00:00,  4.16it/s]    Build Spectra:  90%|█████████ | 27/30 [00:15<00:00,  4.22it/s]    Build Spectra:  93%|█████████▎| 28/30 [00:15<00:00,  4.25it/s]    Build Spectra:  97%|█████████▋| 29/30 [00:15<00:00,  4.28it/s]    Build Spectra: 100%|██████████| 30/30 [00:15<00:00,  4.32it/s]    Build Spectra: 100%|██████████| 30/30 [00:15<00:00,  1.88it/s]




.. GENERATED FROM PYTHON SOURCE LINES 118-119

Look at spectra

.. GENERATED FROM PYTHON SOURCE LINES 119-132

.. code-block:: Python


    i_day = 0
    i_night = data.time.shape[0] // 2
    i_quad = data.time.shape[0] // 4

    fig,ax = plt.subplots(1,1,figsize=(4,3))

    ax.plot(data.wavelength.to_value(u.um),data.spectrum('thermal',i_day),label='Day')
    ax.plot(data.wavelength.to_value(u.um),data.spectrum('thermal',i_night),label='Night')
    ax.plot(data.wavelength.to_value(u.um),data.spectrum('thermal',i_quad),label='Quadrature')
    ax.set_xlabel('Wavelength ($\\mu m$)')
    ax.set_ylabel('Thermal Emission (W/m$^2$/$\\mu m$)')
    _=ax.legend()



.. image-sg:: /auto_examples/other/gcm/images/sphx_glr_plot_twofaced_gcm_004.png
   :alt: plot twofaced gcm
   :srcset: /auto_examples/other/gcm/images/sphx_glr_plot_twofaced_gcm_004.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (1 minutes 7.776 seconds)


.. _sphx_glr_download_auto_examples_other_gcm_plot_twofaced_gcm.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_twofaced_gcm.ipynb <plot_twofaced_gcm.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_twofaced_gcm.py <plot_twofaced_gcm.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_twofaced_gcm.zip <plot_twofaced_gcm.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
